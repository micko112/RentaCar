<div class="car-card-container" [class.expanded]="isDetailsVisible">

  <!-- TOP PART OF THE CARD -->
  <div class="card-main-content">

    <!-- Left side: Info -->
    <div class="info-section">
      <div class="make-logo">
        <img [src]="car.carModel.logoUrl" alt="{{ car.carModel.make }}">
        <span>{{ car.carModel.make }}</span>
      </div>
      <h2>{{ car.carModel.name }} <span class="engine">{{ car.carModel.engineDescription }}</span></h2>

      <div class="specs">
        <span><i class="fas fa-user-friends"></i> {{ car.carModel.seats }} SEDIŠTA </span>
        <span><i class="fas fa-cogs"></i> {{ car.carModel.transmission }}</span>
        <span><i class="fas fa-gas-pump"></i> {{ car.carModel.fuelType }}</span>
      </div>

      <div class="category-tag">{{ car.carModel.category }}</div>
    </div>

    <!-- Middle part: Image -->
    <div class="image-section">
      <img [src]="car.carModel.pictureUrl" alt="{{ car.carModel.name }}">
    </div>

    <!-- Right side: Price -->
    <div class="price-section">
      <div class="price-wrapper">
        <div class="booking-button-wrapper">
          <button class="button" (click)="requestRental()">REZERVIŠI</button>
        </div>
        <div class = "price-info">
          <ng-container *ngIf="numberOfDays > 0; else fromPrice">
            <span class="total-price">{{ totalPrice.toFixed(2) }}€</span>
            <span class="price-details">for {{ numberOfDays }} {{ numberOfDays === 1 ? 'day' : 'days' }}</span>
            <span class="price-details">{{ pricePerDay.toFixed(2) }}€ /day</span>
          </ng-container>
          </div>
        <div class = "show-more">
          <ng-template #fromPrice>
            <span class="from-text">Od  </span>
            <span class="price">{{ car.carModel.priceTier46plus }}€<span class="per-day">  /dan</span></span>
          </ng-template>
        </div>

      </div>
      <!-- CORRECTION: (click) event is now here -->
      <button type="button" class="details-toggle" (click)="toggleDetails()">
        {{ isDetailsVisible ? 'SAKRIJ' : 'PRIKAži' }}
        <i class="fas" [class.fa-chevron-up]="isDetailsVisible" [class.fa-chevron-down]="!isDetailsVisible"></i>
      </button>
    </div>
  </div>

  <!-- BOTTOM PART OF THE CARD (hidden) -->
  <div class="card-details-content" *ngIf="isDetailsVisible">
    <div class="extra-specs">
      <span><i class="fas fa-door-closed"></i> {{ car.carModel.doors }} VRATA</span>
      <span><i class="fas fa-briefcase"></i> {{ car.carModel.luggageCapacity }} KOFERA</span>
      <span *ngIf="car.carModel.hasAc"><i class="fas fa-snowflake"></i> A/C</span>
    </div>
    <div class="pricing-table">
      <div class="pricing-header">
        <span>Dani</span><span>1-3</span><span>4-7</span><span>8-15</span><span>16-30</span><span>31-45</span><span>46+</span>
      </div>
      <div class="pricing-row">
        <span>Cena / dan</span>
        <span>{{ car.carModel.priceTier1to3 }}€</span>
        <span>{{ car.carModel.priceTier4to7 }}€</span>
        <span>{{ car.carModel.priceTier8to15 }}€</span>
        <span>{{ car.carModel.priceTier16to30 }}€</span>
        <span>{{ car.carModel.priceTier31to45 }}€</span>
        <span>{{ car.carModel.priceTier46plus }}€</span>
      </div>
    </div>
  </div>

</div>

<!-- Rental Modal - CORRECTED -->
<app-rental-modal
  *ngIf="showRentalModal"
  [car]="car"
  [totalPrice]="totalPrice"
  [numberOfDays]="numberOfDays"

  (closeModal)="closeModal()"
  (confirmRental)="handleRentalConfirmation()">
</app-rental-modal>
